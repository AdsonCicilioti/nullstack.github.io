
    <!DOCTYPE html>
    <html lang="en">
          <head>      <meta name="generator" content="Created with Nullstack - https://nullstack.app" />      <meta charset="utf-8">      <meta http-equiv="X-UA-Compatible" content="IE=edge">      <title>Context Service Worker - Nullstack</title>      <meta property="og:image" content="https://nullstack.app/image-1200x630.png">      <meta property="og:description" content="The worker is a proxy in the framework store part of your context and gives you granular control of your PWA behavior.">      <meta name="description" content="The worker is a proxy in the framework store part of your context and gives you granular control of your PWA behavior.">      <meta property="og:title" content="Context Service Worker - Nullstack">      <meta property="og:type" content="website">      <meta property="og:site_name" content="Nullstack">      <meta property="og:url" content="https://nullstack.app/service-worker">      <link rel="canonical" href="https://nullstack.app/service-worker">      <meta property="og:locale" content="en">      <link rel="shortcut icon" href="/favicon-96x96.png" type="image/png">      <link rel="icon" href="/favicon-96x96.png" type="image/png">      <link rel="manifest" href="/manifest-68ecd7547e89de6454553837746cd9d9.json" integrity="">      <meta name="mobile-web-app-capable" content="yes">      <meta name="apple-mobile-web-app-capable" content="yes">      <meta name="application-name" content="Nullstack">      <meta name="apple-mobile-web-app-title" content="Nullstack">            <meta name="msapplication-starturl" content="/">      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">      <link rel="stylesheet" href="/client-68ecd7547e89de6454553837746cd9d9.css" integrity="">            <link rel="apple-touch-icon" sizes="180x180" href="/icon-180x180.png">      <meta name="msapplication-TileColor" content="#d22365">      <meta name="theme-color" content="#d22365">    </head>  
      
    <body>
      <div id="application"><main><header class="x12 ftl bgm1 s1"><div class="x xsb yy p4y"><div class="sm-x12 sm-xsb sm-p4x yy"><a href="/" title="Nullstack"><img src="/nullstack.svg" alt="Nullstack" style="height: 30px"/></a><span class="yy md+off"><svg height="20" class="cm2 cd" viewBox="0 0 512 512"><!-- --><!-- --><path d="M484.6172,110.4043H27.3828A27.4136,27.4136,0,0,1,0,83.0215V27.3828A27.4136,27.4136,0,0,1,27.3828,0H484.6172A27.4139,27.4139,0,0,1,512,27.3828V83.0215A27.4139,27.4139,0,0,1,484.6172,110.4043Z" transform="translate(0 0)" fill="currentColor"></path><path d="M484.6172,512H27.3828A27.4139,27.4139,0,0,1,0,484.6172V428.9785a27.4139,27.4139,0,0,1,27.3828-27.3828H484.6172A27.4142,27.4142,0,0,1,512,428.9785v55.6387A27.4142,27.4142,0,0,1,484.6172,512Z" transform="translate(0 0)" fill="currentColor"></path><path d="M484.6172,311.2021H27.3828A27.4138,27.4138,0,0,1,0,283.8193V228.1807a27.4135,27.4135,0,0,1,27.3828-27.3828H484.6172A27.4138,27.4138,0,0,1,512,228.1807v55.6386A27.4142,27.4142,0,0,1,484.6172,311.2021Z" transform="translate(0 0)" fill="currentColor"></path></svg></span></div><nav class="yy sm-p4 sm-off"><a href="/" class="sm-x12 sm-bcm2b p2 ci1h"> <!--#-->About<!--#--> <!--#--></a><a href="/documentation" class="sm-x12 sm-bcm2b p2 ci1h"> <!--#-->Documentation<!--#--> <!--#--></a><a href="/components" class="sm-x12 sm-bcm2b p2 ci1h"> <!--#-->Components<!--#--> <!--#--></a><a href="https://github.com/nullstack/nullstack" target="_blank" class="sm-x12 sm-bcm2b p2 ci1h"> <!--#-->Source<!--#--> <!--#--></a></nav><div class="sm-x12 sm-p4x sm-off"><a href="/getting-started" class="xx sm-x12 bci1 bgi1 bgm1h cm1 ci1h p4x p2y">Get Started<!--#--></a></div></div></header><!-- --><!-- --><!-- --><section class="x sm-p4x sm-p10y md+p20y"><h1 class="x12 sm-f6 md+f8 m6b"> <!--#-->Context Service Worker<!--#--> <!--#--></h1><article><p>The <em>worker</em> is a proxy in the framework store part of your context and gives you granular control of your PWA behavior.</p>
<p>This key is <em>readwrite</em> in the <em>server</em> context.</p>
<p>This key is <em>readonly</em> in the <em>client</em> context.</p>
<p>Worker keys will be used to generate the service worker file and should be set during the <a href="/application-startup">application startup</a>.</p>
<p>Worker keys are frozen after the <a href="/application-startup">application startup</a>.</p>
<p>The following keys are available in the object during the startup:</p>
<ul>
<li><em>enabled</em>: boolean</li>
<li><em>preload</em>: string array (relative paths)</li>
</ul>
<p>The <em>enabled</em> key defines if the service worker will be automatically registered by Nullstack.</p>
<p>By default <em>enabled</em> is set to true on production mode and false on development mode.</p>
<p>Preload is an array of paths that will be cached when the service worker is installed.</p>
<p>The assets required to start the application will be preloaded automatically, and you should configure only the extra pages you want to have available offline.</p>
<pre><code class="language-jsx"><span class="token keyword">import</span> Nullstack <span class="token keyword">from</span> <span class="token string">'nullstack'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token keyword">extends</span> <span class="token class-name">Nullstack</span> <span class="token punctuation">{</span>

  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>worker<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token keyword">default</span><span class="token operator">:</span> path<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>readdirSync<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> articles <span class="token operator">=</span> <span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'articles'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    worker<span class="token punctuation">.</span>preload <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token operator">...</span>articles<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">article</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'/'</span> <span class="token operator">+</span> article<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'.md'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string">'/nullstack.svg'</span><span class="token punctuation">,</span>
      <span class="token string">'/documentation'</span><span class="token punctuation">,</span>
      <span class="token string">'/components'</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// ...</span>

<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Application<span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>ðŸ’¡ the example above is extracted from this repository and allows the documentation to be fully accessible offline.</p>
</blockquote>
<p>The following keys are available as <em>readonly</em> in the client context:</p>
<ul>
<li><em>enabled</em>: boolean</li>
<li><em>preload</em>: string array (relative paths)</li>
<li><em>online</em>: boolean</li>
<li><em>fetching</em>: boolean</li>
<li><em>responsive</em>: boolean</li>
<li><em>installation</em>: BeforeInstallPromptEvent</li>
<li><em>registration</em>: ServiceWorkerRegistration</li>
</ul>
<p>When a <a href="/server-functions">server function</a> is called <em>fetching</em> will be set to true until the response is resolved.</p>
<p>The <em>responsive</em> key determines if the application has all the responses it needs to render the current page.</p>
<p>Nullstack will try to keep your application <em>responsive</em> as long as possible and set the key to false only when there are no ways of retrieving any response from the network or offline according to the fetch strategy for the <a href="/context-environment">environment</a>.</p>
<p>The <em>online</em> key will listen for network events and rerender the application when navigator.onLine value changes.</p>
<p>When the application is back online Nullstack will try to make the application <em>responsive</em> again and rerender if necessary.</p>
<pre><code class="language-jsx"><span class="token keyword">import</span> Nullstack <span class="token keyword">from</span> <span class="token string">'nullstack'</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>

<span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token keyword">extends</span> <span class="token class-name">Nullstack</span> <span class="token punctuation">{</span>
 
  <span class="token comment">// ...</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>worker<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>worker<span class="token punctuation">.</span>responsive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">OfflineWarning</span></span> <span class="token punctuation">/></span></span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span> <span class="token attr-name">route</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<p>You can access the current service worker <em>registration</em> and <em>installation</em> from the worker key to control the flow of your PWA.</p>
<p>The <em>registration</em> key refers to the service worker registration and will be only available once the registration process is complete.</p>
<p>The <em>installation</em> key refers to the deferred installation prompt event and will only be available if the <em>beforeinstallprompt</em> event is triggered.</p>
<pre><code class="language-jsx"><span class="token keyword">import</span> Nullstack <span class="token keyword">from</span> <span class="token string">'nullstack'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PWAInstaller</span> <span class="token keyword">extends</span> <span class="token class-name">Nullstack</span> <span class="token punctuation">{</span>

  installed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  hidden <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>worker<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      worker<span class="token punctuation">.</span>installation<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>outcome<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> worker<span class="token punctuation">.</span>installation<span class="token punctuation">.</span>userChoice<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>outcome <span class="token operator">===</span> <span class="token string">'accepted'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'User accepted the A2HS prompt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'User dismissed the A2HS prompt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>hidden <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>worker<span class="token punctuation">,</span> project<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>hidden<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>worker<span class="token punctuation">.</span>installation<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>project<span class="token punctuation">.</span>favicon<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span> Do you want to add <span class="token punctuation">{</span>project<span class="token punctuation">.</span>name<span class="token punctuation">}</span> to your home screen<span class="token operator">?</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>prompt<span class="token punctuation">}</span></span><span class="token punctuation">></span></span> Install <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>hidden<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span> Not Now <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> PWAInstaller<span class="token punctuation">;</span>
</code></pre>
<h2>Server-side render strategy</h2>
<ul>
<li>Requests for different origins will be fetched normally;</li>
<li>Requests that are not GET will be fetched normally;</li>
<li>Fingerprinted assets will be loaded into cache at installation time;</li>
<li>Fingerprinted assets will be loaded from cache first then fallback to the network if needed;</li>
<li>Paths with an extension will be retrieved stale and update the cache in the background for subsequent request;</li>
<li>Navigation paths will be loaded from the network then fallback to a page in which <em>worker.responsive</em> and <em>worker.online</em> are set to false;</li>
</ul>
<h2>Static-site generation strategy</h2>
<ul>
<li>Requests for different origins will be fetched normally;</li>
<li>Requests that are not GET will be fetched normally;</li>
<li>Fingerprinted assets will be loaded into cache at installation time;</li>
<li>Fingerprinted assets will be loaded from cache first then fallback to the network if needed;</li>
<li>Paths with an extension will be retrieved stale and update the cache in the background for subsequent request;</li>
<li>The home page will be loaded network first and then fallback to a cached copy if needed;</li>
<li>Navigation paths will instead load only the static API data and merge it with the application template to generate a response.</li>
<li>Navigating to a static route will cache only the data of that page;</li>
<li>When data is not available in the cache or network it will fallback to a page in which <em>worker.responsive</em> and <em>worker.online</em> are set to false;</li>
</ul>
<h2>Custom Strategy</h2>
<p>Nullstack will install automatically your service worker if <em>enabled</em> is set to true with the following events:</p>
<ul>
<li>install</li>
<li>activate</li>
<li>fetch</li>
</ul>
<p>You can override any of those events by creating a <em>service-worker.js</em> in the public folder;</p>
<p>If any of the keywords above are found Nullstack will inject your function in the service worker code instead of the default.</p>
<p>For convenience a <em>context</em> key is injected in the service worker <em>self</em> with the following keys:</p>
<ul>
<li>worker</li>
<li><a href="/context-project">project</a></li>
<li><a href="/context-environment">environment</a></li>
</ul>
<pre><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">activate</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> cacheNames <span class="token operator">=</span> <span class="token keyword">await</span> caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> cachesToDelete <span class="token operator">=</span> cacheNames<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">cacheName</span> <span class="token operator">=></span> cacheName <span class="token operator">!==</span> self<span class="token punctuation">.</span>context<span class="token punctuation">.</span>environment<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>cachesToDelete<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cacheName</span><span class="token punctuation">)</span> <span class="token operator">=></span> caches<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>registration<span class="token punctuation">.</span>navigationPreload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> self<span class="token punctuation">.</span>registration<span class="token punctuation">.</span>navigationPreload<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    self<span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> activate<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>ðŸ’¡ The example above is extracted from the generated service worker and uses self.context.environment.key</p>
</blockquote>
<h2>Next step</h2>
<p>âš” Learn <a href="/how-to-deploy-a-nullstack-application">how to deploy a Nullstack application</a>.</p>
</article></section><footer class="xx bcm2t p10y"><img src="/nullstack.svg" alt="Nullstack" style="height: 30px"/><p class="x12 m3t"> Â© <!--#-->2020<!--#--> Nullstack <!--#--></p></footer><script async src="https://www.googletagmanager.com/gtag/js?id=G-E7GZ5Z4MLN"></script><!-- --></main></div>
      <script async defer>
        window.page = {"image":"/image-1200x630.png","locale":"en","title":"Context Service Worker - Nullstack","description":"The worker is a proxy in the framework store part of your context and gives you granular control of your PWA behavior."};
        window.context = {"project":{"type":"website","display":"standalone","orientation":"portrait","scope":"/","root":"/","favicon":"/favicon-96x96.png","icons":{"72":"/icon-72x72.png","96":"/icon-96x96.png","128":"/icon-128x128.png","144":"/icon-144x144.png","152":"/icon-152x152.png","180":"/icon-180x180.png","192":"/icon-192x192.png","384":"/icon-384x384.png","512":"/icon-512x512.png"},"name":"Nullstack","domain":"nullstack.app","color":"#d22365"},"params":{"slug":"service-worker"}};
        window.instances = {"_.0":{},"_.0.0.0":{"expanded":false},"_.0.0.4":{"title":"Context Service Worker","html":"<p>The <em>worker</em> is a proxy in the framework store part of your context and gives you granular control of your PWA behavior.</p>\n<p>This key is <em>readwrite</em> in the <em>server</em> context.</p>\n<p>This key is <em>readonly</em> in the <em>client</em> context.</p>\n<p>Worker keys will be used to generate the service worker file and should be set during the <a href=\"/application-startup\">application startup</a>.</p>\n<p>Worker keys are frozen after the <a href=\"/application-startup\">application startup</a>.</p>\n<p>The following keys are available in the object during the startup:</p>\n<ul>\n<li><em>enabled</em>: boolean</li>\n<li><em>preload</em>: string array (relative paths)</li>\n</ul>\n<p>The <em>enabled</em> key defines if the service worker will be automatically registered by Nullstack.</p>\n<p>By default <em>enabled</em> is set to true on production mode and false on development mode.</p>\n<p>Preload is an array of paths that will be cached when the service worker is installed.</p>\n<p>The assets required to start the application will be preloaded automatically, and you should configure only the extra pages you want to have available offline.</p>\n<pre><code class=\"language-jsx\"><span class=\"token keyword\">import</span> Nullstack <span class=\"token keyword\">from</span> <span class=\"token string\">'nullstack'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Application</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Nullstack</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">static</span> <span class=\"token keyword\">async</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>worker<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">default</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>readdirSync<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> articles <span class=\"token operator\">=</span> <span class=\"token function\">readdirSync</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'..'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'articles'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    worker<span class=\"token punctuation\">.</span>preload <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token operator\">...</span>articles<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">article</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token string\">'/'</span> <span class=\"token operator\">+</span> article<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.md'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'/nullstack.svg'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'/documentation'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'/components'</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n  \n  <span class=\"token comment\">// ...</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Application<span class=\"token punctuation\">;</span>\n</code></pre>\n<blockquote>\n<p>ðŸ’¡ the example above is extracted from this repository and allows the documentation to be fully accessible offline.</p>\n</blockquote>\n<p>The following keys are available as <em>readonly</em> in the client context:</p>\n<ul>\n<li><em>enabled</em>: boolean</li>\n<li><em>preload</em>: string array (relative paths)</li>\n<li><em>online</em>: boolean</li>\n<li><em>fetching</em>: boolean</li>\n<li><em>responsive</em>: boolean</li>\n<li><em>installation</em>: BeforeInstallPromptEvent</li>\n<li><em>registration</em>: ServiceWorkerRegistration</li>\n</ul>\n<p>When a <a href=\"/server-functions\">server function</a> is called <em>fetching</em> will be set to true until the response is resolved.</p>\n<p>The <em>responsive</em> key determines if the application has all the responses it needs to render the current page.</p>\n<p>Nullstack will try to keep your application <em>responsive</em> as long as possible and set the key to false only when there are no ways of retrieving any response from the network or offline according to the fetch strategy for the <a href=\"/context-environment\">environment</a>.</p>\n<p>The <em>online</em> key will listen for network events and rerender the application when navigator.onLine value changes.</p>\n<p>When the application is back online Nullstack will try to make the application <em>responsive</em> again and rerender if necessary.</p>\n<pre><code class=\"language-jsx\"><span class=\"token keyword\">import</span> Nullstack <span class=\"token keyword\">from</span> <span class=\"token string\">'nullstack'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Application</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Nullstack</span> <span class=\"token punctuation\">{</span>\n \n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>worker<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>worker<span class=\"token punctuation\">.</span>responsive<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OfflineWarning</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>main</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Home</span></span> <span class=\"token attr-name\">route</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>main</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>You can access the current service worker <em>registration</em> and <em>installation</em> from the worker key to control the flow of your PWA.</p>\n<p>The <em>registration</em> key refers to the service worker registration and will be only available once the registration process is complete.</p>\n<p>The <em>installation</em> key refers to the deferred installation prompt event and will only be available if the <em>beforeinstallprompt</em> event is triggered.</p>\n<pre><code class=\"language-jsx\"><span class=\"token keyword\">import</span> Nullstack <span class=\"token keyword\">from</span> <span class=\"token string\">'nullstack'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PWAInstaller</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Nullstack</span> <span class=\"token punctuation\">{</span>\n\n  installed <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  hidden <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>worker<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      worker<span class=\"token punctuation\">.</span>installation<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>outcome<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> worker<span class=\"token punctuation\">.</span>installation<span class=\"token punctuation\">.</span>userChoice<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>outcome <span class=\"token operator\">===</span> <span class=\"token string\">'accepted'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'User accepted the A2HS prompt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'User dismissed the A2HS prompt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>hidden <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  \n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>worker<span class=\"token punctuation\">,</span> project<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>hidden<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>worker<span class=\"token punctuation\">.</span>installation<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>project<span class=\"token punctuation\">.</span>favicon<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span> Do you want to add <span class=\"token punctuation\">{</span>project<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span> to your home screen<span class=\"token operator\">?</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onclick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>prompt<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span> Install <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onclick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>hidden<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span> Not Now <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> PWAInstaller<span class=\"token punctuation\">;</span>\n</code></pre>\n<h2>Server-side render strategy</h2>\n<ul>\n<li>Requests for different origins will be fetched normally;</li>\n<li>Requests that are not GET will be fetched normally;</li>\n<li>Fingerprinted assets will be loaded into cache at installation time;</li>\n<li>Fingerprinted assets will be loaded from cache first then fallback to the network if needed;</li>\n<li>Paths with an extension will be retrieved stale and update the cache in the background for subsequent request;</li>\n<li>Navigation paths will be loaded from the network then fallback to a page in which <em>worker.responsive</em> and <em>worker.online</em> are set to false;</li>\n</ul>\n<h2>Static-site generation strategy</h2>\n<ul>\n<li>Requests for different origins will be fetched normally;</li>\n<li>Requests that are not GET will be fetched normally;</li>\n<li>Fingerprinted assets will be loaded into cache at installation time;</li>\n<li>Fingerprinted assets will be loaded from cache first then fallback to the network if needed;</li>\n<li>Paths with an extension will be retrieved stale and update the cache in the background for subsequent request;</li>\n<li>The home page will be loaded network first and then fallback to a cached copy if needed;</li>\n<li>Navigation paths will instead load only the static API data and merge it with the application template to generate a response.</li>\n<li>Navigating to a static route will cache only the data of that page;</li>\n<li>When data is not available in the cache or network it will fallback to a page in which <em>worker.responsive</em> and <em>worker.online</em> are set to false;</li>\n</ul>\n<h2>Custom Strategy</h2>\n<p>Nullstack will install automatically your service worker if <em>enabled</em> is set to true with the following events:</p>\n<ul>\n<li>install</li>\n<li>activate</li>\n<li>fetch</li>\n</ul>\n<p>You can override any of those events by creating a <em>service-worker.js</em> in the public folder;</p>\n<p>If any of the keywords above are found Nullstack will inject your function in the service worker code instead of the default.</p>\n<p>For convenience a <em>context</em> key is injected in the service worker <em>self</em> with the following keys:</p>\n<ul>\n<li>worker</li>\n<li><a href=\"/context-project\">project</a></li>\n<li><a href=\"/context-environment\">environment</a></li>\n</ul>\n<pre><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">activate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> cacheNames <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> cachesToDelete <span class=\"token operator\">=</span> cacheNames<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cacheName</span> <span class=\"token operator\">=></span> cacheName <span class=\"token operator\">!==</span> self<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>environment<span class=\"token punctuation\">.</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>cachesToDelete<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cacheName</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>cacheName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>registration<span class=\"token punctuation\">.</span>navigationPreload<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">await</span> self<span class=\"token punctuation\">.</span>registration<span class=\"token punctuation\">.</span>navigationPreload<span class=\"token punctuation\">.</span><span class=\"token function\">enable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    self<span class=\"token punctuation\">.</span>clients<span class=\"token punctuation\">.</span><span class=\"token function\">claim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nself<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'activate'</span><span class=\"token punctuation\">,</span> activate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<blockquote>\n<p>ðŸ’¡ The example above is extracted from the generated service worker and uses self.context.environment.key</p>\n</blockquote>\n<h2>Next step</h2>\n<p>âš” Learn <a href=\"/how-to-deploy-a-nullstack-application\">how to deploy a Nullstack application</a>.</p>\n","description":"The worker is a proxy in the framework store part of your context and gives you granular control of your PWA behavior."},"_.0.0.6":{}};
        window.environment = {"client":false,"server":true,"development":false,"production":true,"static":true,"key":"68ecd7547e89de6454553837746cd9d9"};
        window.settings = {};
        window.worker = {"enabled":true,"fetching":false,"preload":["/application-startup","/context-environment","/context-loading","/context-page","/context-project","/context-secrets","/context-settings","/context","/full-stack-lifecycle","/getting-started","/how-to-deploy-a-nullstack-application","/how-to-use-facebook-pixel-with-nullstack","/how-to-use-google-analytics-with-nullstack","/how-to-use-mongodb-with-nullstack","/instance-key","/instance-self","/njs-file-extension","/renderable-components","/routes-and-params","/server-functions","/server-request-and-response","/server-side-rendering","/service-worker","/stateful-components","/static-site-generation","/styles","/two-way-bindings","/nullstack.svg","/documentation","/components"],"online":true,"responsive":true};
        document.addEventListener('DOMContentLoaded', () => {
          const script = window.document.createElement( 'script' );
          script.src = '/client-68ecd7547e89de6454553837746cd9d9.js';
          document.body.append(script);
        });
      </script>
    </body>
  
    </html>
  